# RPI Waveshare TFT Clock

A fullscreen, touch-dismissable, idle-activated digital clock for Raspberry Pi running Debian + GNOME.

Designed for Waveshare TFT displays on Raspberry Pi 5, but works on any X11-based GNOME desktop.

---

## What it does

- After N seconds of inactivity → clock appears fullscreen
- Tap the screen (or press Escape / Q) → clock dismisses
- Idle again → clock returns
- No GNOME screensaver, no compositor hacks, no kiosk mode

---

## Features

- Fullscreen GTK3 window
- Configurable 12-hour or 24-hour clock
- Multiple date style options
- Configurable colors for background, time, date, and label
- Optional top label (e.g. server name / hostname)
- Configurable idle timeout
- Touch and keyboard dismiss
- Auto-reappears after idle
- GNOME Activities overview auto-dismissed on login

---

## Directory Structure

```
RPI-waveshare-tft-clock/
├── bin/
│   └── clock_gtk.py          ← clock source (deployed to ~/bin/ by installer)
├── service-launchers/
│   └── idle_clock_launcher.sh  ← generated by install.sh
├── install.sh                ← run this to install or reconfigure
└── README.md
```

---

## Requirements

- Debian Bookworm (or compatible)
- GNOME running on X11
- Python 3.11
- Waveshare TFT or compatible display

---

## Installation

Clone the repository into your home directory:

```bash
git clone https://github.com/mr-tbot/RPI-waveshare-tft-clock.git
cd RPI-waveshare-tft-clock
```

Run the installer:

```bash
chmod +x install.sh
./install.sh
```

Reboot:

```bash
sudo reboot
```

---

## Configuration

All configuration lives at the top of `install.sh`. Edit those values and re-run the installer to apply changes — no need to touch any other file.

```bash
# -- Top label (displayed above the clock) ------------------------------------
SHOW_LABEL="true"          # true | false
LABEL_TEXT="BOT-CLOCK v1.0"

# -- Time format ---------------------------------------------------------------
CLOCK_24HR="false"         # true = 24-hour  |  false = 12-hour with AM/PM

# -- Date style ----------------------------------------------------------------
DATE_STYLE="weekday-mdy"
# Options:
#   weekday-mdy  →  Wednesday / 02-19-2026   (US)
#   weekday-dmy  →  Wednesday / 19-02-2026   (EU)
#   weekday-iso  →  Wednesday / 2026-02-19   (ISO)
#   mdy          →  02-19-2026
#   dmy          →  19-02-2026
#   iso          →  2026-02-19
#   none         →  (no date shown)

# -- Colors (CSS hex values) --------------------------------------------------
COLOR_BG="#000000"         # Window background
COLOR_TIME="#ff8c00"       # Time digits
COLOR_DATE="#9aa0a6"       # Date text
COLOR_LABEL="#9aa0a6"      # Top label text

# -- Idle timeout --------------------------------------------------------------
IDLE_TIMEOUT_MS=60000      # Milliseconds before clock appears
```

To reconfigure, edit the values and re-run:

```bash
./install.sh
```

The installer bakes the config values directly into the deployed clock script (`~/bin/clock_gtk.py`) and regenerates the launcher.

---

## How It Works

At login:
1. GNOME starts
2. The autostart launcher runs
3. It dismisses the Activities overview
4. A background idle polling loop begins
5. After `IDLE_TIMEOUT_MS` ms of no input → clock launches
6. Tap screen or press Escape/Q → clock exits
7. Idle again → clock relaunches

Idle detection: `xprintidle`
Clock rendering: GTK3 via PyGObject

---

## Troubleshooting

**Clock does not appear**

Check idle detection is working:
```bash
xprintidle
```

Confirm display is set:
```bash
echo $DISPLAY
# should be :0
```

**Python gi import error**
```bash
/usr/bin/python3.11 -c "import gi"
# If that fails:
sudo apt install python3-gi gir1.2-gtk-3.0
```

**GNOME boots into Activities Overview**

The launcher automatically presses `Super` once at login after a short delay. If it's not dismissing reliably, increase the `sleep 5` in `idle_clock_launcher.sh`.

---

## Design Philosophy

Intentionally avoids:
- GNOME screensaver / xscreensaver
- Kiosk mode
- Mutter / compositor hacks
- Wayland complexity

Uses instead:
- Deterministic X11 behavior
- Simple idle polling
- Clean GTK3 fullscreen window
- Shell supervision loop

Goal: stability and predictability.

---

## Future Ideas

- Wayland compatibility
- Fade-in animation
- Ambient brightness auto-adjust
- Network / temperature status overlay
- Systemd user service instead of autostart

---

## License

MIT

## Author

Built by TBOT — https://mr-tbot.com